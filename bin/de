#!/usr/bin/env ruby

require 'pathname'
env = Pathname.pwd.ascend
  .reduce([]){|a, x| a << x.join(".env.#{ENV['NAME']}") << x.join(".env")}
  .reverse
  .select(&:exist?)
  .map(&:read)
  .join

regexp = /^(?<a>\w+)=(?:'(?<b>.+?)'|"\g<b>"|\g<b>)$/m
ENV.update env.scan(regexp).to_h.merge(ENV.to_h)
exec(ENV, *ARGV)
