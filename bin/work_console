#! /usr/bin/env ruby

require 'socket'
require 'FileUtils'
require 'pathname'
require 'cli/ui'


socket_path = "/tmp/work_console.sock"

at_exit { FileUtils.rm socket_path }

server = UNIXServer.new(socket_path)
CLI::UI::StdoutRouter.enable

Socket.accept_loop(server) do |socket, _addr|
  case socket.read.strip
  when 'hello world 1'
    puts 1
    CLI::UI.ask('What language/framework do you use?', options: %w(rails go ruby python))
  when 'hello world 2'
    puts 2
    spin_group = CLI::UI::SpinGroup.new
    spin_group.add('Title')   { |spinner| sleep 3.0 }
    spin_group.add('Title 2') { |spinner| sleep 3.0; spinner.update_title('New Title'); sleep 3.0 }
    spin_group.wait
  end
  socket.close
end
